# Arknights: Endfield Database

アークナイツ：エンドフィールドの製品・レシピデータベースと効率分析。

## 概要

このリポジトリは以下を提供します：

1. **製品データベース** - 拠点取引で出荷可能な製品の一覧と取引券価格
2. **レシピデータベース** - 一次原材料から最終製品までの全生産チェーン
3. **効率分析** - 電力コストを含めた実効利益率の比較

## ファイル構成

```
endfield_db/
├── README.md                    # このファイル
├── valley4_products.json        # 四号谷地の出荷製品データベース
├── wuling_products.json         # 武陵の出荷製品データベース
├── recipes.json                 # 生産レシピ・マシン電力データベース
└── docs/
    ├── valley4_analysis.md      # 四号谷地 出荷製品の効率分析
    ├── wuling_analysis.md       # 武陵 出荷製品の効率分析
    └── optimization_problem.md  # 生産ポートフォリオ最適化問題
```

## データベース

### valley4_products.json

四号谷地（Valley IV）で拠点取引可能な全14製品。

```json
{
  "id": "sc_valley_battery",
  "name_ja": "中容量谷地バッテリー",
  "name_en": "SC Valley Battery",
  "trade_value": 30
}
```

### wuling_products.json

武陵（Wuling）で拠点取引可能な全4製品。

```json
{
  "id": "lc_wuling_battery",
  "name_ja": "小容量武陵バッテリー",
  "name_en": "LC Wuling Battery",
  "trade_value": 25
}
```

### recipes.json

全39レシピと10種のマシン電力データ（四号谷地・武陵共通）。

```json
{
  "machines": {
    "grinding_unit": { "name_en": "Grinding Unit", "power": 50 },
    "forge_of_the_sky": { "name_en": "Forge of the Sky", "power": 50, "region": "wuling" }
  },
  "recipes": {
    "xiranite": {
      "machine": "forge_of_the_sky",
      "time_sec": 2,
      "inputs": { "stabilized_carbon": 2, "clean_water": 1 },
      "outputs": { "xiranite": 1 },
      "region": "wuling"
    }
  }
}
```

## 効率分析

採掘・栽培の電力コストを含めた完全なコスト分析を行っています。

### 言葉の定義

- 地域：四号谷地、武陵などを指す
- 拠点：それぞれの地域に存在する、取引が可能な場所。例えば四号谷地では仮設居住地、建設基地、再建管理本部の3つ。武陵では現在1つのみ。
- 取引券：**地域ごと**に存在する固有の通貨。

### 最適化に対する考え方

エンドフィールドの生産ポートフォリオのプランニングは、与えられた有限の鉱物資源採掘レートに対して、最大の取引券出荷効率を求める問題だと考えることができる。
二次目標として**最小手動売却間隔**を取り、これが長期であるほど優れた工場（メンテナンスの手間が少ない）と見なせる。

前提条件：
- それぞれの地域において、得ることのできる鉱物資源のレートは有限
  - 最大拡張時の採掘資源レート（/min）:

    | 地域 | 源石鉱 | 紫晶鉱 | 青鉄鉱 |
    |---|--:|--:|--:|
    | 四号谷地 | 560 | 240 | 1080 |
    | 武陵 | 360 | 0 | 90 |

- 資源ごとの貯蓄上限は有限
  - 最大拡張時の貯蓄上限（/アイテム種別）:

    | 地域 | 上限 |
    |---|--:|
    | 四号谷地 | 80,000 |
    | 武陵 | 48,000 |

- 製品の売却は人間が手動で行う必要がある
  - **最小手動売却間隔**を長くしたい場合は、単価の高い製品もしくは、生産ポートフォリオの分散が有利となる
- 地域の各拠点ごとに、取引券の貯蓄レートと貯蓄上限が存在
  - 拠点に蓄積されている取引券を得る形で販売を行う
  - 拠点に蓄積されている以上製品を販売することはできない
    - 従って、拠点の取引券貯蓄レートが実質的な販売上限
  - 各拠点の取引券蓄積レートと上限:

    | 地域 | 拠点 | 蓄積レート | 上限 | 満タンまで |
    |---|---|--:|--:|--:|
    | 四号谷地 | 仮設居住地 | 20,820/h | 2,200,000 | 約106時間 |
    | 四号谷地 | 建設基地 | 27,840/h | 3,000,000 | 約108時間 |
    | 四号谷地 | 再建管理本部 | 42,840/h | 3,800,000 | 約89時間 |
    | 武陵 | 天王原 | 12,900/h | 1,250,000 | 約97時間 |

基本的な戦略：
- 目標とする**最小売却間隔** （=ログイン頻度）を決める
- 各製品が非ログイン期間に貯蓄上限に到達せず、消費する鉱物資源の量が生産を下回らない範囲で、最も効率の良い製品ポートフォリオを計算可能
- 拠点ごとに扱う商品が違うため、それぞれの拠点で販売可能な製品を用意する必要がある

### 実質コストに対する考え方

#### 電力のコスト

- 地域間転送は非常に低速なため、バッテリーを用いた電力輸送は実質的に不可能。
  - 従って電力は現地のバッテリー生産で得る必要がある。
- バッテリーは取引が可能なため、その取引価格を用いて、電力当たりの取引券コストを試算可能。これは地域ごとに異なる
  - 電力は、それを消費せずにバッテリーとして売却した場合に得られるはずの利益の機会損失として考えることができる

#### 原材料のコスト

ある製品の販売価格の効率の良さを評価するには、電力と同等に原材料の鉱石をどのくらい消費するかを勘案する必要がある。

- 単一種類の鉱石（＋植物/水）を原料とする、最も単純なレシピを持つ販売可能な製品がその地域に存在する場合は、その価格から電力コストを差し引いたものを用いて、材料コスト（取引券価格）を計算する。
  - 当然、この計算は地域ごとに適用される。
- 上記の方法で単価を計算できない鉱石については、複数種類の鉱石を利用する商品の価格を用いて計算する。

なお、原材料コストは鉱石にのみ適用される。（植物/水は電気を用いて無限に生産できるため、電力コストのみ考えればよい。）

### 四号谷地

[四号谷地 出荷製品の効率分析](docs/valley4_analysis.md) では、全14製品について原材料消費レート、電力コスト、実効利益率を算出しています。

| 指標 | 最良の選択肢 |
|---|---|
| 実効利益率 | 蕎花カプセルⅢ / シトローム缶詰Ⅲ (+68.9%) |
| 実効利益/min | 蕎花カプセルⅢ / シトローム缶詰Ⅲ (+171.4/min) |
| 避けるべき製品 | 蕎花カプセルⅠ / シトローム缶詰Ⅰ (−7.0%) |

**主な発見:**
- 植物は電力で無限に栽培できるため**材料価値=0**と評価すべき
- 蕎花/シトローム/サンドリーフを使う製品はむしろ**高利益率**
- 鉱石のみの基礎素材（結晶外殻/紫晶部品/鉄製部品）は利益ゼロ

### 武陵

[武陵 出荷製品の効率分析](docs/wuling_analysis.md) では、全4製品について同様の分析を行っています。

| 指標 | 結果 |
|---|---|
| 最高効率 | 息壌 (+1105%) |
| 損益分岐点 | 錦草ソーダ / 芽針注射剤Ⅰ / 小容量バッテリー (~0%) |

**主な発見:**
- 息壌は植物と水のみで製造でき、鉱石を消費しないため**極めて高効率**
- 武陵は電力コストが四号谷地の1/4で、植物ベースの製品が有利
- 鉱石を使う製品は損益分岐点付近なので、鉱石は装備製作等に温存すべき

### 最適化問題

[生産ポートフォリオ最適化問題](docs/optimization_problem.md) では、取引券生産レートを最大化する製品ポートフォリオの求め方を定式化しています。

## データソース

- [Endfield Talos Wiki (wiki.gg)](https://endfield.wiki.gg/)
- [Game8 エンドフィールド攻略](https://game8.jp/arknights-endfield)

## ライセンス

データは攻略情報の引用・整理であり、ゲーム内データの著作権は Hypergryph / Gryphline に帰属します。
